!function(){var a={_puppets:{},puppets:function(a,b,c){var d;return this._hasPuppet(a)?d=this._getPuppet(a):b&&b.prototype._isPuppet&&(d=new b(a,this,c),this._puppets[a]=d),d},_hasPuppet:function(a){return _.has(this._puppets,a)},_getPuppet:function(a){return this._puppets[a]}};Marionette.Application.prototype=_.extend(Marionette.Application.prototype,a)}(),function(){var a=Marionette.Region.extend({_defaultDuration:500,_defaultTransition:"pop",constructor:function(){Marionette.Region.prototype.constructor.apply(this,Array.prototype.slice(arguments))},_trigger:function(a){this.vent.trigger("region:"+a)},open:function(a){a.delegateEvents(),"fade"===this.transition?this.slide(this.$el,"in",a):"slide"===this.transition?this.fade(this.$el,"in",a):this.pop(this.$el,"in",a)},closeView:function(a){a.close?a.close():a.remove&&a.remove(),this._trigger("close"),Marionette.triggerMethod.call(this,"close"),delete this.currentView},slide:function(a,b,c){var d=this;"in"===b?(d._trigger("open"),a.hide(),a.html(c.el),a.slideDown(d.duration,function(){d._trigger("ready")})):(d._trigger("closing"),a.slideUp(d.duration,function(){_.bind(d.closeView,d,c)()}))},fade:function(a,b,c){var d=this;if("in"===b){a.hide(),a.html(c.el);var d=this;d._trigger("open"),a.fadeIn(d.duration,function(){d._trigger("ready")})}else d._trigger("closing"),a.fadeOut(d.duration,function(){_.bind(d.closeView,d,c)()})},pop:function(a,b,c){"in"===b?(this._trigger("open"),a.empty().append(c.el),this._trigger("ready")):(this._trigger("closing"),a.empty(),_.bind(this.closeView,this,c)())},close:function(){var a=this.currentView;a&&!a.isClosed&&("fade"===this.transition?this.slide(this.$el,"out",a):"slide"===this.transition?this.fade(this.$el,"out",a):this.pop(this.$el,"out",a))}});window.Puppets=window.Puppets||{},window.Puppets.Region=a}(),function(){var a=Marionette.ItemView.extend({modelEvents:{change:"update"},constructor:function(){this._rendered=!1,Marionette.View.prototype.constructor.apply(this,Array.prototype.slice.apply(arguments))},render:function(){this.isClosed=!1,this.triggerMethod("before:render",this),this.triggerMethod("item:before:render",this);var a=this.serializeData();a=this.mixinTemplateHelpers(a);var b=this.getTemplate(),c=Marionette.Renderer.render(b,a);return this.$el.html(c),this.bindUIElements(),this.triggerMethod("render",this),this.triggerMethod("item:rendered",this),this},updateDOM:function(){var a=$.Deferred();this.updatePromises.push(a),a.resolve()},update:function(){this._isRendered&&(this._shareUpdating(),this.updatePromises=[],this.updateDOM.apply(this,Array.prototype.slice.apply(arguments)),$.when.apply($,this.updatePromises).then(_.bind(this._shareUpdate,this)))},_shareUpdating:function(){this.vent.trigger("view:updating")},_shareUpdate:function(){this.vent.trigger("view:update")}});window.Puppets=window.Puppets||{},window.Puppets.ItemView=a}(),window.Puppets.Puppet=Marionette.Controller.extend({_isPuppet:!0,constructor:function(a,b,c){this.puppetName=a,this.app=b,c=c||{},this._setLocalWreqr(),this._setDefaultState(),this._configRegion(c),Marionette.Controller.prototype.constructor.apply(this,Array.prototype.slice(arguments)),this._configEvents(c),this._components={},this._linkComponents(),this.configureComponents(c)},configureComponents:function(){},_configRegion:function(a){if(a.region){this.component("region",a.region);var b=this.component("region");b.duration=a.duration||Puppets.Region._defaultDuration,b.transition=a.transition||Puppets.Region._defaultTransition}},component:function(a,b){return b?_.has(this._components,a)?!1:(this._components[a]=b,void 0):this._components[a]},_linkComponents:function(){this.components&&_.each(this.components,function(a,b){a.componentName=b,a.puppetName=this.puppetName,a.localVent=this.localVent,a.localCommands=this.localCommands,a.localReqres=this.localReqres,this.component(b,a)},this)},_startedPuppet:function(){this._changeState("started"),this.emitGlobalEvent("start")},_readyPuppet:function(){this._changeState("ready"),this.emitGlobalEvent("ready")},_stoppingPuppet:function(){this._changeState("stopping"),this.emitGlobalEvent("closing")},_stoppedPuppet:function(){this._changeState("stopped"),this.emitGlobalEvent("close")},_shareViewUpdating:function(){this.emitGlobalEvent("updating")},_shareViewUpdate:function(){this.emitGlobalEvent("update")},show:function(){this.region&&this.itemView&&this.region.show(this.itemView)},close:function(){this.region&&this.region.close()}}),_.extend(window.Puppets.Puppet.prototype,{_defaultLocalEvents:{"open:region":"_startedPuppet","ready:region":"_readyPuppet","closing:region":"_stoppingPuppet","close:region":"_stoppedPuppet"},_defaultLocalRequests:{},_defaultLocalCommands:{},_defaultGlobalCommands:{start:"start",stop:"stop"},_defaultGlobalRequests:{isStarted:"_isStarted",isReady:"_isReady",isStopping:"_isStopping",isStopped:"_isStopped"},_defaultGlobalEvents:{},_getDefaultNames:function(a){var b={},c=":puppets."+this.puppetName;return _.each(a,function(a,d){d+=c,b[d]=a},this),b},_configEvents:function(a){this._configLocalWreqr(),this._configGlobalWreqr(a)},_setLocalWreqr:function(){this.localVent=new Backbone.Wreqr.EventAggregator,this.localCommands=new Backbone.Wreqr.Commands,this.localReqres=new Backbone.Wreqr.RequestResponse},_configLocalWreqr:function(){var a=_.extend(this._defaultLocalEvents,this.localEventsHash);a=this._methodsFromHash(a);var b=_.extend(this._defaultLocalRequests,this.localRequestsHash);b=this._methodsFromHash(b);var c=_.extend(this._defaultLocalCommands,this.localCommandsHash);c=this._methodsFromHash(c),_.each(a,function(a,b){this.localVent.on(b,_.bind(a,this))},this),_.each(c,function(a,b){this.localCommands.setHandler(b,_.bind(a,this))},this),_.each(b,function(a,b){this.localReqres.setHandler(b,_.bind(a,this))},this)},_configGlobalWreqr:function(a){var b=this._getDefaultNames(this._defaultGlobalCommands),c=this._getDefaultNames(this._defaultGlobalRequests),d=this._getDefaultNames(this._defaultGlobalEvents),e=_.extend({},b,a.commands),f=_.extend({},c,a.requests),g=_.extend({},d,a.events),h=this._methodsFromHash(e),i=this._methodsFromHash(f),j=this._methodsFromHash(g);_.each(h,function(a,b){this.app.commands.setHandler(b,_.bind(a,this))},this),_.each(i,function(a,b){this.app.reqres.setHandler(b,_.bind(a,this))},this),_.each(j,function(a,b){this.app.vent.on(b,_.bind(a,this))},this)},_methodsFromHash:function(a){var b={};return _.each(a,function(a,c){method=a,_.isFunction(method)||(method=this[method]),method&&(b[c]=method)},this),b},_suffixEventName:function(a){return a+":puppets."+this.puppetName},emitGlobalEvent:function(a){arguments[0]=this._suffixEventName(a),this.app.vent.trigger.apply(this.app.vent,Array.prototype.slice.apply(arguments))}}),_.extend(window.Puppets.Puppet.prototype,{_states:{_stoppedState:{started:!1,ready:!1,stopped:!0,stopping:!1},_stoppingState:{started:!0,ready:!1,stopping:!0,stopped:!1},_readyState:{started:!0,ready:!0,stopping:!1,stopped:!1},_startedState:{started:!0,ready:!1,stopping:!1,stopped:!1}},defaultState:"stopped",_setDefaultState:function(){this._changeState(this.defaultState)},_changeState:function(a){var b=this._states["_"+a+"State"];_.extend(this,b)},_isStarted:function(){return this.started},_isStopped:function(){return this.stopped},_isReady:function(){return this.ready},_isStopping:function(){return this.stopping}});