Backbone.Channel={addChannel:function(a,b,c,d){return a=a||"local",b=b||new Backbone.Wreqr.EventAggregator,c=c||new Backbone.Wreqr.Commands,d=d||new Backbone.Wreqr.RequestResponse,this._channels=this._channels||{},this._channels[a]={channelName:a,vent:b,commands:c,reqres:d},this._channels[a]},removeChannel:function(a){var b=this.channel(a);b&&(b.vent.off(),b.reqres.removeAllHandlers(),b.commands.removeAllHandlers(),delete b)},channel:function(a){return this._channels[a]},attachVent:function(a,b){return b=b||"local",a=this._methodsFromHash(a),_.each(a,function(a,c){this.channel(b).vent.on(c,_.bind(a,this))},this),this},attachCommands:function(a,b){return b=b||"local",a=this._methodsFromHash(a),_.each(a,function(a,c){this.channel(b).commands.setHandler(c,_.bind(a,this))},this),this},attachRequests:function(a,b){return b=b||"local",a=this._methodsFromHash(a),_.each(a,function(a,c){this.channel(b).reqres.setHandler(c,_.bind(a,this))},this),this},_configChannel:function(a){if(a){{var b,c,d,e,f,g,h=a.channelName;a.vent,a.commands,a.reqres}if(this._defaultEvents&&this._defaultEvents[h]){var i=this._defaultEvents[h];b=i.vent,c=i.commands,d=i.requests}this.channelsHash&&(e=this.channelsHash.vent,f=this.channelsHash.commands,g=this.channelsHash.requests);var j=_.extend({},b,e),k=_.extend({},c,f),l=_.extend({},d,g);this.attachVent(j,h).attachCommands(k,h).attachRequests(l,h)}},_methodsFromHash:function(a){var b={};return _.each(a,function(a,c){method=a,_.isFunction(method)||(method=this[method]),method&&(b[c]=method)},this),b}},function(){var a={_puppets:{},puppets:function(a,b,c){var d;return this._hasPuppet(a)?d=this._getPuppet(a):b&&b.prototype._isPuppet&&(d=new b(a,this,c),this._puppets[a]=d),d},_hasPuppet:function(a){return _.has(this._puppets,a)},_getPuppet:function(a){return this._puppets[a]}};Marionette.Application.prototype=_.extend(Marionette.Application.prototype,a)}(),function(){var a=Marionette.Region.extend({_defaultDuration:500,_defaultTransition:"pop",constructor:function(){Marionette.Region.prototype.constructor.apply(this,Array.prototype.slice(arguments))},_trigger:function(a){this.vent.trigger("region:"+a)},open:function(a){a.delegateEvents(),"fade"===this.transition?this.slide(this.$el,"in",a):"slide"===this.transition?this.fade(this.$el,"in",a):this.pop(this.$el,"in",a)},closeView:function(a){a.close?a.close():a.remove&&a.remove(),this._trigger("close"),Marionette.triggerMethod.call(this,"close"),delete this.currentView},slide:function(a,b,c){var d=this;"in"===b?(d._trigger("open"),a.hide(),a.html(c.el),a.slideDown(d.duration,function(){d._trigger("ready")})):(d._trigger("closing"),a.slideUp(d.duration,function(){_.bind(d.closeView,d,c)()}))},fade:function(a,b,c){var d=this;if("in"===b){a.hide(),a.html(c.el);var d=this;d._trigger("open"),a.fadeIn(d.duration,function(){d._trigger("ready")})}else d._trigger("closing"),a.fadeOut(d.duration,function(){_.bind(d.closeView,d,c)()})},pop:function(a,b,c){"in"===b?(this._trigger("open"),a.empty().append(c.el),this._trigger("ready")):(this._trigger("closing"),a.empty(),_.bind(this.closeView,this,c)())},close:function(){var a=this.currentView;a&&!a.isClosed&&("fade"===this.transition?this.slide(this.$el,"out",a):"slide"===this.transition?this.fade(this.$el,"out",a):this.pop(this.$el,"out",a))}});window.Puppets=window.Puppets||{},window.Puppets.Region=a}(),function(){var a=Marionette.ItemView.extend({modelEvents:{change:"update"},constructor:function(){this._rendered=!1,Marionette.View.prototype.constructor.apply(this,Array.prototype.slice.apply(arguments))},render:function(){this.isClosed=!1,this.triggerMethod("before:render",this),this.triggerMethod("item:before:render",this);var a=this.serializeData();a=this.mixinTemplateHelpers(a);var b=this.getTemplate(),c=Marionette.Renderer.render(b,a);return this.$el.html(c),this.bindUIElements(),this.triggerMethod("render",this),this.triggerMethod("item:rendered",this),this},updateDOM:function(){var a=$.Deferred();this.updatePromises.push(a),a.resolve()},update:function(){this._isRendered&&(this._shareUpdating(),this.updatePromises=[],this.updateDOM.apply(this,Array.prototype.slice.apply(arguments)),$.when.apply($,this.updatePromises).then(_.bind(this._shareUpdate,this)))},_shareUpdating:function(){this.vent.trigger("view:updating")},_shareUpdate:function(){this.vent.trigger("view:update")}});window.Puppets=window.Puppets||{},window.Puppets.ItemView=a}(),window.Puppets.Puppet=Marionette.Controller.extend({_isPuppet:!0,constructor:function(a,b,c){this.puppetName=a,this.app=b,c=c||{};var d=this.addChannel(),e=this.addChannel("global",this.app.vent,this.app.commands,this.app.reqres);this._setDefaultState(),this._configRegion(c),Marionette.Controller.prototype.constructor.apply(this,Array.prototype.slice(arguments)),this._configChannel(d),this._configChannel(e),this._components={},this._linkComponents(),this.configureComponents(c)},configureComponents:function(){},_configRegion:function(a){if(a.region){this.component("region",a.region);var b=this.component("region");b.duration=a.duration||Puppets.Region._defaultDuration,b.transition=a.transition||Puppets.Region._defaultTransition}},component:function(a,b){return b?_.has(this._components,a)?!1:(this._components[a]=b,void 0):this._components[a]},_linkComponents:function(){var a=this.channel("local");this.components&&_.each(this.components,function(b,c){b.componentName=c,b.puppetName=this.puppetName,_.extend(b,Backbone.Channel),b.addChannel("local",a.vent,a.commands,a.reqres),this.component(c,b)},this)},_startedPuppet:function(){this._changeState("started"),this.emitGlobalEvent("start")},_readyPuppet:function(){this._changeState("ready"),this.emitGlobalEvent("ready")},_stoppingPuppet:function(){this._changeState("stopping"),this.emitGlobalEvent("closing")},_stoppedPuppet:function(){this._changeState("stopped"),this.emitGlobalEvent("close")},_shareViewUpdating:function(){this.emitGlobalEvent("updating")},_shareViewUpdate:function(){this.emitGlobalEvent("update")},start:function(){console.log("Ok"),this.region&&this.itemView&&this.region.show(this.itemView)},stop:function(){this.region&&this.region.close()},_defaultEvents:{local:{vent:{"open:region":"_startedPuppet","ready:region":"_readyPuppet","closing:region":"_stoppingPuppet","close:region":"_stoppedPuppet"}},global:{commands:{start:"start",stop:"stop"},requests:{isStarted:"_isStarted",isReady:"_isReady",isStopping:"_isStopping",isStopped:"_isStopped"}}},_suffixEventName:function(a){return a+":puppets."+this.puppetName},emit:function(a){arguments[0]=this._suffixEventName(a),this.app.vent.trigger.apply(this.app.vent,Array.prototype.slice.apply(arguments))}}),_.extend(window.Puppets.Puppet.prototype,Backbone.Channel),_.extend(window.Puppets.Puppet.prototype,{_states:{_stoppedState:{started:!1,ready:!1,stopped:!0,stopping:!1},_stoppingState:{started:!0,ready:!1,stopping:!0,stopped:!1},_readyState:{started:!0,ready:!0,stopping:!1,stopped:!1},_startedState:{started:!0,ready:!1,stopping:!1,stopped:!1}},defaultState:"stopped",_setDefaultState:function(){this._changeState(this.defaultState)},_changeState:function(a){var b=this._states["_"+a+"State"];_.extend(this,b)},_isStarted:function(){return this.started},_isStopped:function(){return this.stopped},_isReady:function(){return this.ready},_isStopping:function(){return this.stopping}});